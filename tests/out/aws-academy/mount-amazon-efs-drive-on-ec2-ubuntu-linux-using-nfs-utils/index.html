<!DOCTYPE html>
<html lang="en">

<head>

    <!-- Metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=yes" />
    <meta name="generator" content="Pelican 4.7.1" />
<meta name="author" content="Rehan Haider">
<meta name="keywords" content="AWS, Python">
    <meta name="description" content=" A comprehensive guide to mount Amazon Elastic File Storage (EFS) on Ubuntu Linux using NFS Utils and then use it to serve files from the EFS drive. The guided includes instructions for both AWS Console &amp; CLI ">
    <link rel="canonical" href="http://localhost:8080/aws-academy/mount-amazon-efs-drive-on-ec2-ubuntu-linux-using-nfs-utils">

    <!-- Prefetches -->
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="prefetch" as="script" href="/assets/js/app.js" />

    <!-- Title -->
    <title> Mount Amazon EFS Drive on EC2 Ubuntu Linux using NFS Utils </title>
    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="/assets/img/icons/favicon.svg">
    <link rel="icon" type="image/png" href="/assets/img/icons/favicon.png">
    <!-- App icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="manifest" href="/assets/site.webmanifest">
    <meta name="msapplication-TileColor" content="#fdf6e3">
    <meta name="msapplication-config" content="/assets/browserconfig.xml">
    <meta name="theme-color" content="#fff">

    <!-- Social -->
    <meta property="og:title" content="Mount Amazon EFS Drive on EC2 Ubuntu Linux using NFS Utils" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="<jinja2.runtime.BlockReference object at 0x7fdf7736a9b0>" />
    <meta property="og:image" content="/assets/img/banner.png" />
    <meta property="og:description" content="A comprehensive guide to mount Amazon Elastic File Storage (EFS) on Ubuntu Linux using NFS Utils and then use it to serve files from the EFS drive. The guided includes instructions for both AWS Console & CLI" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@cloudbytes_dev" />
    <meta name="twitter:title" content="Mount Amazon EFS Drive on EC2 Ubuntu Linux using NFS Utils" />
    <meta name="twitter:description" content="A comprehensive guide to mount Amazon Elastic File Storage (EFS) on Ubuntu Linux using NFS Utils and then use it to serve files from the EFS drive. The guided includes instructions for both AWS Console & CLI" />
    <meta name="twitter:image" content="/assets/img/banner.png" />


    <!-- Theme -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- App -->
    <script defer src="/assets/js/app.js"></script>
    <!-- Ad
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0503340532690886"
        crossorigin="anonymous"></script>
         -->
</head>

<body>
    <!--Top nav-->
    <nav class="topnav">
<div style="visibility: visible;">
    <div id="search-open" class="item mega-dropdown" style="border-radius: 15px 0 0 15px;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128">
            <path fill="currentColor"
                d="M120.5891,106.37506,96.5609,80.39355l-3.842,3.8457-4.35187-4.35187c.33368-.43195.667-.864.98346-1.30475A46.77661,46.77661,0,1,0,77.87956,89.85687q.99472-.68619,1.955-1.42987l4.34509,4.345-4.31427,4.31409,26.5097,23.5246a10.0585,10.0585,0,1,0,14.21405-14.23566ZM74.21977,74.22931a32.4793,32.4793,0,1,1,9.48859-22.94189A32.48241,32.48241,0,0,1,74.21977,74.22931Z" />
        </svg>
    </div>
</div>

<div class="item" style="border-radius: 0;">
    <a href="https://github.com/CloudBytesDotDev/CloudBytes.dev/discussions" target="_blank" rel="noopener"
        aria-label="GitHub">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
            <path fill="currentColor"
                d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
            </path>
        </svg>
    </a>
</div>

<div id="themeButton">
    <div id="dark" class="item">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <g class="fa-group">
                <path fill="currentColor"
                    d="M320 32L304 0l-16 32-32 16 32 16 16 32 16-32 32-16zm138.7 149.3L432 128l-26.7 53.3L352 208l53.3 26.7L432 288l26.7-53.3L512 208z"
                    class="fa-secondary"></path>
                <path fill="currentColor"
                    d="M332.2 426.4c8.1-1.6 13.9 8 8.6 14.5a191.18 191.18 0 0 1-149 71.1C85.8 512 0 426 0 320c0-120 108.7-210.6 227-188.8 8.2 1.6 10.1 12.6 2.8 16.7a150.3 150.3 0 0 0-76.1 130.8c0 94 85.4 165.4 178.5 147.7z"
                    class="fa-primary"></path>
            </g>
        </svg>
    </div>
    <div id="light" class="item">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <g class="fa-group">
                <path fill="currentColor"
                    d="M502.42 240.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.41-94.8a17.31 17.31 0 0 0-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4a17.31 17.31 0 0 0 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.41-33.5 47.3 94.7a17.31 17.31 0 0 0 31 0l47.31-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3a17.33 17.33 0 0 0 .2-31.1zm-155.9 106c-49.91 49.9-131.11 49.9-181 0a128.13 128.13 0 0 1 0-181c49.9-49.9 131.1-49.9 181 0a128.13 128.13 0 0 1 0 181z"
                    class="fa-secondary"></path>
                <path fill="currentColor" d="M352 256a96 96 0 1 1-96-96 96.15 96.15 0 0 1 96 96z" class="fa-primary">
                </path>
            </g>
        </svg>
    </div>
</div>
<menu-toggler style="visibility: visible;">
    <div id="open" class="item  mega-dropdown" style="border-radius: 0 15px 15px 0;">
        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 32 32"
            style="enable-background:new 0 0 32 32;" xml:space="preserve">
            <g>
                <path fill="currentColor" d="M16,10c1.7,0,3-1.3,3-3s-1.3-3-3-3s-3,1.3-3,3S14.3,10,16,10z" />
                <path fill="currentColor" d="M16,13c-1.7,0-3,1.3-3,3s1.3,3,3,3s3-1.3,3-3S17.7,13,16,13z" />
                <path fill="currentColor" d="M16,22c-1.7,0-3,1.3-3,3s1.3,3,3,3s3-1.3,3-3S17.7,22,16,22z" />
            </g>
        </svg>
    </div>
    <div id="close" class="item mega-dropdowns" style="border-radius: 0 15px 15px 0; display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 72.434 72.44"
            style="enable-background:new 0 0 72.434 72.44;" xml:space="preserve">
            <path style="fill:currentColor;" d="M36.22,0C16.212,0,0,16.216,0,36.227c0,19.999,16.212,36.214,36.22,36.214
       c20.011,0,36.214-16.215,36.214-36.214C72.434,16.215,56.231,0,36.22,0z M52.058,46.82c1.379,1.424,0.953,4.078-0.959,5.932
       c-1.911,1.854-4.577,2.209-5.959,0.785l-9.027-9.295l-9.298,9.027c-1.421,1.379-4.075,0.947-5.929-0.961s-2.206-4.574-0.785-5.956
       l9.298-9.027l-9.027-9.298c-1.379-1.421-0.946-4.078,0.962-5.932c1.905-1.851,4.577-2.204,5.953-0.785l9.027,9.297l9.301-9.023
       c1.424-1.382,4.078-0.95,5.929,0.958c1.857,1.908,2.206,4.577,0.785,5.959l-9.295,9.024L52.058,46.82z" />
        </svg>
    </div>
</menu-toggler>

<div id="mega" class="mega-menu" style="visibility: hidden;">
    <div class="mega-main">
        <section>
            <h3>Content</h3>
            <ul>
                <li><a href="/snippets">Quick Snippets</a></li>
                <li><a href="/books">Books</a></li>
                <li><a href="/tags">#tags</a></li>
            </ul>
        </section>
        <section>
            <h3>Tags</h3>
            <ul>
                <li><a href="/tags/python">#python</a></li>
                <li><a href="/tags/aws">#aws</a></li>
                <li><a href="/tags/firebase">#firebase</a></li>
                <li><a href="/tags/python">#pelican</a></li>
            </ul>
        </section>
        <section>
            <h3>CloudBytes@</h3>
            <ul>
                <li><a href="http://github.com/CloudBytesDotDev">Github</a></li>
            </ul>
        </section>
    </div>
    <div class="row mega-footer">
        <span>CloudBytes</span> <a href="/terms">Terms</a> <a href="/privacy">Privacy</a>
    </div>
</div>
<div id="search" class="modal-overlay modal-show" style="visibility: hidden;">
    <div class="algolia-hits">
        <div class="algolia-form-wrap">
            <input placeholder="Search for bytes ..." type="text" id="algolia-input" class="algolia-input"
                autocomplete="off" />
            <span id="search-close" class="algolia-close btn btn-red">X</span>
        </div>
    </div>
</div><!--End Topnav-->
    </nav>
    <!--Top nav-->
    <script>
        // Theme toggler
        const themeNext = {
            dark: "light",
            light: "dark"
        };
        var theme = "dark";
        if (localStorage.getItem('theme')) {
            theme = localStorage.getItem('theme');
        }
        document.body.classList.remove('dark-theme', 'light-theme');
        document.body.classList.add(theme + '-theme');
        document.getElementById(themeNext[theme]).style.display = "flex";
        document.getElementById(theme).style.display = "none";
        // Theme button events
        var switchTheme = document.getElementById('themeButton');
        var toggleLight = document.getElementById('light');
        var toggleDark = document.getElementById('dark');
        switchTheme.addEventListener('click', function (e) {
            e.preventDefault();
        });
        toggleLight.addEventListener('click', function (e) {
            e.preventDefault();
            document.body.classList.add('light-theme');
            document.body.classList.remove('dark-theme');
            localStorage.setItem('theme', 'light');
            toggleLight.style.display = "none";
            toggleDark.style.display = "flex";
        });
        toggleDark.addEventListener('click', function (e) {
            e.preventDefault();
            document.body.classList.add('dark-theme');
            document.body.classList.remove('light-theme');
            localStorage.setItem('theme', 'dark');
            toggleLight.style.display = "flex";
            toggleDark.style.display = "none";
        });
    </script>
    <!-- Navbar -->
    <nav class="navbar">
<a href="/" id="home" class="item logo" style="opacity: 1;">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="home" class="svg-inline--fa fa-home fa-w-18"
        role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
        <path fill="currentColor"
            d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z">
        </path>
    </svg>
    <span class="item-label tag tag-contrast tag-sm">Home</span>
</a>
<a href="/snippets" id="snippets" class="item">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="code" class="svg-inline--fa fa-code fa-w-20"
        role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
        <path fill="currentColor"
            d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z">
        </path>
    </svg>
    <span class="item-label tag tag-contrast tag-sm">How-to Articles</span>
</a>
<a href="/books" id="books" class="item">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="book" class="svg-inline--fa fa-book fa-w-14"
        role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
        <path fill="currentColor"
            d="M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z">
        </path>
    </svg>
    <span class="item-label tag tag-contrast tag-sm">Publications</span>
</a>
<a href="/tags" id="tags" class="item">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tags" class="svg-inline--fa fa-tags fa-w-20"
        role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
        <path fill="currentColor"
            d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z">
        </path>
    </svg>
    <span class="item-label tag tag-contrast tag-sm">Tags</span>
</a>    </nav>
    <!-- End Navbar -->

    <!-- Main Section -->
    <main>
<article class="content-pad">
    <div class="content-main">
        <section class="content-article">
<h1 id="title" class="article-title">Mount Amazon EFS Drive on EC2 Ubuntu Linux using NFS Utils</h1>
<div class="article-byline">
    <em>by <a href="/authors/rehan-haider">Rehan Haider</a>, Mon 13 June 2022</em>
    <span>
        <strong>Category</strong>:
        <a href="/aws-academy" class="tag tag-aws academy">
            AWS Academy
        </a>
    </span>
</div>            <article id="content">
                <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#what-is-amazon-efs">What is Amazon EFS?</a><ul>
<li><a href="#efs-mount-on-ec2-how-it-works">EFS mount on EC2 - How it works?</a></li>
</ul>
</li>
<li><a href="#project-lab-setup">Project Lab Setup</a><ul>
<li><a href="#objectives">Objectives</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li><a href="#how-to-mount-an-amazon-efs-to-ec2">How to Mount an Amazon EFS to EC2?</a><ul>
<li><a href="#mount-amazon-efs-to-ec2-ubuntu-linux-using-aws-console">Mount Amazon EFS to EC2 Ubuntu Linux using AWS Console</a></li>
<li><a href="#mount-amazon-efs-to-ec2-ubuntu-linux-using-aws-cli">Mount Amazon EFS to EC2 Ubuntu Linux using AWS CLI</a></li>
</ul>
</li>
</ul>
</div>
<p>The first question that you should be asking yourself is, why not use <code>amazon-efs-utils</code> to <a href="https://docs.aws.amazon.com/efs/latest/ug/installing-amazon-efs-utils.html">mount the EFS drive</a>?</p>
<p>In short, <code>amazon-efs-utils</code> package is only available for Amazon Linux and other Linux versions require you to build it from scratch. Also the fact that EFS is supposed to act like a Network File System (NFS) and that almost all Linux versions have an already available &amp; extensively tested NFS Utilities. </p>
<blockquote>
<p>Even though EFS mount helper is comparatively easier to use, NFS is still preferred by most enterprises because they want to use proven and throughly tested utilities especially if they impact important services.</p>
</blockquote>
<h2 id="what-is-amazon-efs">What is Amazon EFS?</h2>
<p>Amazon Elastic File Storage (EFS) is a network mountable elastic shared drive. Which means, you can attach/mount it to your Linux machine as a network drive and it starts with a capacity of almost 0 and can easily grow into Petabytes of storage. </p>
<h3 id="efs-mount-on-ec2-how-it-works">EFS mount on EC2 - How it works?</h3>
<p>The below architecture diagram explains a typical use case of how EFS is used with EC2.</p>
<p><img alt="EFS EC2 Architecure diagram" src="http://localhost:8080/images/aws-academy/25000000-architecture-diagram.png"></p>
<ol>
<li>The VM(s) that will mount the drive  are typically in their own subnets and security groups. In the example above, a webserver is connected to internet using port 80 or 443 and kept in a publicly accessible subnet.</li>
<li>The EFS drive could should ideally be kept in a separate subnet and security group.</li>
<li>The two security groups DMZ SG (which contains the EC2 instance) and the NFS SG (which contains the EFS drive) are connected to allow traffic between them over port 2049</li>
</ol>
<h2 id="project-lab-setup">Project Lab Setup</h2>
<h3 id="objectives">Objectives</h3>
<p><strong>In this tutorial, we will </strong></p>
<ol>
<li>Create an EC2 webserver with Apache installed</li>
<li>Create an EFS drive </li>
<li>Mount the EFS drive on the EC2 webserver</li>
<li>Download a image file onto the EFS drive</li>
<li>Create a basic HTML page that will display image</li>
</ol>
<h3 id="prerequisites">Prerequisites</h3>
<p>You need an AWS Account and AWS CLI installed on your system. You can find the instructions on how to install AWS CLI <a href="http://localhost:8080/aws-academy/how-to-install-and-configure-aws-cli-on-linux-with-autocompletion">here</a>.</p>
<h2 id="how-to-mount-an-amazon-efs-to-ec2">How to Mount an Amazon EFS to EC2?</h2>
<p>We will mount the EFS drive on EC2 using two methods:</p>
<ul>
<li>Using AWS Management Console</li>
<li>Using AWS CLI</li>
</ul>
<h3 id="mount-amazon-efs-to-ec2-ubuntu-linux-using-aws-console">Mount Amazon EFS to EC2 Ubuntu Linux using AWS Console</h3>
<h4 id="step-1-create-the-security-groups">Step 1) Create the security groups</h4>
<p>We need to create two security groups as follows:</p>
<ol>
<li><strong>DMZ SG</strong> - This SG is used to allow traffic from the internet to the EC2 instance, i.e. port 80 or 443.</li>
<li><strong>NFS SG</strong> - This SG is used to allow traffic from the members of the DMZ SG to the EFS drive over port 2049.</li>
</ol>
<p>A) Logon to AWS Management Console:</p>
<ul>
<li>Search for <strong>Security Groups</strong> and click on <strong>Security Group</strong> under features. </li>
<li>Click on <strong>Create security group</strong> on the top right.</li>
</ul>
<p>B) In the <strong>Create Security Group</strong> dialog:</p>
<ul>
<li>Enter <code>DMZ</code> as the name, <code>Security group for DMZ</code> as the description. </li>
<li>In the <strong>inbound rules</strong> section, click on <strong>Add Rule</strong>, </li>
<li>Under <strong>Type</strong> select <code>http</code> and under <strong>Source</strong> select <code>Anywhere-IPv4</code>. </li>
<li>CLick on <strong>Add Rule</strong> again, and under type search for <code>SSH</code> and under <strong>Source</strong> select <code>Anywhere-IPv4</code>.</li>
<li>Then scroll to bottom and click on <strong>Create security group</strong>.</li>
</ul>
<p><img alt="Create Security Group AWS Console" src="http://localhost:8080/images/aws-academy/25000000-create-dmz-security-console.png"></p>
<p>C) Next, Go back to <strong>Security Groups</strong> page and click on <strong>Create security group</strong> again. In the <strong>Create Security Group</strong> dialog:</p>
<ul>
<li>Enter <code>NFS</code> as the name, <code>Security group for NFS</code> as the description. </li>
<li>In the <strong>inbound rules</strong> section, under <strong>Type</strong> select <code>NFS</code> and under <strong>Source</strong> click on the textbox to bring up a list of CIDR &amp; Security Group options. </li>
<li>Select <code>DMZ|sg-xxxxxxx</code>, i.e. the security group we created earlier, under security groups. Then scroll to bottom and click on <strong>Create security group</strong>.</li>
</ul>
<p><img alt="Create Security Group AWS Console" src="http://localhost:8080/images/aws-academy/25000000-create-nfs-security-console.png"></p>
<h4 id="step-2-create-the-efs-drive">Step 2) Create the EFS Drive</h4>
<p>Log on to <a href="https://console.aws.amazon.com/">AWS Console</a>, search for EFS and then click on EFS.</p>
<p><img alt="AWS Console EFS" src="http://localhost:8080/images/aws-academy/25000000-efs-console.png"></p>
<p>Click on "<strong>Create file system</strong>", in the <strong>Create File System</strong> dialog:</p>
<ul>
<li>Choose a name for your file system, I chose <strong>myEFS</strong>.</li>
<li>Under <strong>Availability and durability</strong> section, choose <strong>One Zone</strong> </li>
<li>Under <strong>Availability Zone</strong> choose <code>us-east-1a</code> and then click on <strong>Create</strong> button</li>
</ul>
<p>Now you should see a File system created named <strong>myEFS</strong> under <strong>File systems</strong> section.</p>
<p><img alt="EFS File system created" src="http://localhost:8080/images/aws-academy/25000000-efs-filesystem-created.png"></p>
<h4 id="step-3-customise-efs-configure-security-groups">Step 3) Customise EFS &amp; Configure Security Groups</h4>
<p>Because we used the quick create option and didn't customize our EFS file system, it was created with several default settings such as:</p>
<ol>
<li><strong>Automatic backups</strong>: Enabled</li>
<li><strong>Lifecycle management</strong>: EFS Intelligent tiering is enabled, and configured to transition files from Standard to Standard-Infrequent Access tier after 30 days of inactivity and to transition out on first access.</li>
<li><strong>Performance mode</strong>: Only <strong>General Purpose</strong> is available for <strong>One ZOne</strong>.</li>
<li><strong>Throughput mode</strong>: <strong>Bursting</strong> is selected by default. The alternative is <strong>Provisioned</strong>.</li>
<li><strong>Encryption</strong>: Enabled</li>
<li><strong>Network access</strong>: Default VPC, default subnet, and default security group associated with the Availability Zone is selected</li>
</ol>
<p>While 1 - 5 are file, we need to modify the <strong>Network access</strong> to enable the EFS to communicate with the EC2 instance on port 2049.</p>
<p>A) In the left hand panel, </p>
<ul>
<li>Click on <strong>File systems</strong>, then under <strong>File system</strong>, click on <strong>myEFS</strong>. </li>
<li>At the bottom, select the <strong>Network</strong> tab. </li>
<li>Then click on <strong>Manage</strong> button after <strong>Mount target state</strong> becomes <strong>Available</strong>.</li>
</ul>
<p><img alt="EFS Network Settings" src="http://localhost:8080/images/aws-academy/25000000-network-settings.png"></p>
<p>B) In the <strong>Network access</strong> page, under <strong>Mount targets</strong>, </p>
<ul>
<li>Remove the existing default <strong>Security Group</strong></li>
<li>Click on the dropdown under <strong>Security Groups</strong> and select <code>NFS|sg-xxxxxxx</code></li>
<li>Then save the changes</li>
</ul>
<p><img alt="change-efs-security-group" src="http://localhost:8080/images/aws-academy/25000000-change-efs-security-group.gif"></p>
<h4 id="step-4-create-the-ec2-ubuntu-linux-instance">Step 4) Create the EC2 Ubuntu Linux instance</h4>
<p>Search for EC2, and click on EC2 to go to the EC2 page. In the left hand navigation panel, click on <strong>Instances</strong>.</p>
<p>Now on top right, click on <strong>Launch instances</strong>, then</p>
<ul>
<li><strong>Name and tags</strong> section, provide a name. I Chose <code>myServer1</code></li>
<li><strong>Application and OS Images</strong> section, select <strong>Ubuntu</strong>, then from the dropdown, select <strong>Ubuntu 20.04</strong>.</li>
<li><strong>Instance type</strong> section, select <strong>t2.micro</strong>.</li>
<li><strong>Key pair</strong> section, select any keypair, or create one if you don't have one.</li>
<li><strong>Network setting</strong>, click on <strong>Edit</strong> button, then change the subnet to the one in <code>us-east-1</code>. Then click on <strong>Select existing security group</strong> and from dropdown, select <code>DMZ|sg-xxxxxxx</code></li>
<li><strong>Configure storage</strong>, leave unchanged</li>
<li>Then click on <strong>Launch instance</strong> button.</li>
</ul>
<h4 id="step-5-login-to-the-ec2-instance">Step 5) Login to the EC2 instance</h4>
<p>Go to the EC2 console and click on <strong>Instances</strong>. Click on the instance you created in the previous step, then on top right, click on <strong>Connect</strong>. </p>
<p>In <strong>Connect to instance</strong> dialog, click on <strong>EC2 Instance Connect</strong> and then at the bottom right, click on <strong>Connect</strong>.</p>
<p>Install NFS Utilities and enable it to start on startup.</p>
<div class="highlight"><pre><span></span><code>sudo apt install nfs-common -y <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo systemctl status nfs-utils
</code></pre></div>

<h4 id="step-6-mount-the-efs-drive">Step 6) Mount the EFS Drive</h4>
<p>Go to the EFS, click on the EFS file system you created, e.g. <strong>myEFS</strong>. At the bottom, click on network and note the IP address.  </p>
<p>Next, mount the EFS drive to the EC2 instance. Replace <code>&lt;EFS IP&gt;</code> with the IP address from above.</p>
<div class="highlight"><pre><span></span><code>mkdir efs
sudo mount -t nfs4 -o <span class="nv">nfsvers</span><span class="o">=</span><span class="m">4</span>.1,rsize<span class="o">=</span><span class="m">1048576</span>,wsize<span class="o">=</span><span class="m">1048576</span>,hard,timeo<span class="o">=</span><span class="m">600</span>,retrans<span class="o">=</span><span class="m">2</span>,noresvport &lt;EFS IP&gt;:/ efs
</code></pre></div>

<p>Alternatively, then click on <em>Attach</em><em>. In the subsequent dialog, select on </em><em>Mount via IP</em>*. Copy the command provided and run it in the EC2 Ubuntu terminal from previous step.</p>
<p><img alt="EFS mount command" src="http://localhost:8080/images/aws-academy/25000000-mount-command.png"></p>
<p>Next, run the below command in the EC2 terminal.</p>
<div class="highlight"><pre><span></span><code>lsblk
</code></pre></div>

<p>You should now see the EFS drive mounted as a new partition.</p>
<p><img alt="25000000-check-efs-mount-lsblk" src="http://localhost:8080/images/aws-academy/25000000-check-efs-mount-lsblk.png"></p>
<h4 id="step-7-test-the-mounted-efs-drive">Step 7) Test the mounted EFS Drive</h4>
<p>A) Now let's download a few files and save them in the directory.</p>
<div class="highlight"><pre><span></span><code>sudo curl -X GET https://cataas.com/cat -o efs/myFile.jpg
</code></pre></div>

<p>B) List the files</p>
<div class="highlight"><pre><span></span><code>ls -al efs
</code></pre></div>

<p><img alt="25000000-output-server1" src="http://localhost:8080/images/aws-academy/25000000-output-server1.png"></p>
<p>C) Now follow steps 4, 5 and 6 again to create another EC2 instance. </p>
<ol>
<li>Follow <a href="#step-4-create-the-ec2-ubuntu-linux-instance">step 4</a> to create another EC2 instance named <code>myServer2</code></li>
<li>Follow <a href="#step-5-login-to-the-ec2-instance">step 5</a> lo login to the server</li>
<li>Follow <a href="#step-6-mount-the-efs-drive">step 6</a> to mount the EFS drive on the new server</li>
</ol>
<p>D) Now run <code>ls -al efs</code> to check the contents of the mounted directory. This should be the same as that of <strong>myServer1</strong> above.</p>
<p><img alt="25000000-efs-check-server2" src="http://localhost:8080/images/aws-academy/25000000-efs-check-server2.png"></p>
<h3 id="mount-amazon-efs-to-ec2-ubuntu-linux-using-aws-cli">Mount Amazon EFS to EC2 Ubuntu Linux using AWS CLI</h3>
<h4 id="step-1-create-security-groups">Step 1: Create Security Groups</h4>
<p>A) We need to create two security groups as follows:</p>
<ol>
<li><strong>DMZ SG</strong> - This SG is used to allow traffic from the internet to the EC2 instance, i.e. port 80 or 443.</li>
<li><strong>NFS SG</strong> - This SG is used to allow traffic from the members of the DMZ SG to the EFS drive over port 2049.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nv">DMZ_SG_ID</span><span class="o">=</span><span class="k">$(</span>aws ec2 create-security-group --group-name <span class="s2">&quot;DMZ&quot;</span> <span class="se">\</span>
  --description <span class="s2">&quot;Security group for DMZ&quot;</span> --query <span class="s2">&quot;GroupId&quot;</span> --output text<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
  <span class="nv">NFS_SG_ID</span><span class="o">=</span><span class="k">$(</span>aws ec2 create-security-group --group-name <span class="s2">&quot;NFS&quot;</span> <span class="se">\</span>
  --description <span class="s2">&quot;Security group for NFS&quot;</span> --query <span class="s2">&quot;GroupId&quot;</span> --output text<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
  <span class="nb">echo</span> <span class="s2">&quot;Created security groups: DMZ: </span><span class="nv">$DMZ_SG_ID</span><span class="s2"> and NFS: </span><span class="nv">$NFS_SG_ID</span><span class="s2">&quot;</span>
</code></pre></div>

<p>This will create the security groups and assign the IDs to the variables.</p>
<p>B) Next open port 80 &amp; 22 access from anywhere (CIDR 0.0.0.0/0) for DMZ security group</p>
<div class="highlight"><pre><span></span><code>aws ec2 authorize-security-group-ingress --group-id <span class="nv">$DMZ_SG_ID</span> <span class="se">\</span>
    --protocol tcp --port <span class="m">80</span> --cidr <span class="m">0</span>.0.0.0/0 <span class="o">&amp;&amp;</span> <span class="se">\</span>
    aws ec2 authorize-security-group-ingress --group-id <span class="nv">$DMZ_SG_ID</span> <span class="se">\</span>
    --protocol tcp --port <span class="m">22</span> --cidr <span class="m">0</span>.0.0.0/0
</code></pre></div>

<p>Next allow access from DMZ SG to NFS SG over port 2049.</p>
<div class="highlight"><pre><span></span><code>aws ec2 authorize-security-group-ingress --group-id <span class="nv">$NFS_SG_ID</span> <span class="se">\</span>
    --source-group <span class="nv">$DMZ_SG_ID</span> --protocol tcp --port <span class="m">2049</span>
</code></pre></div>

<h4 id="step-2-create-efs-file-system">Step 2: Create EFS File System</h4>
<p>A) Create a new EFS file system named myEFS in <code>us-east-1a</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nv">EFS_ID</span><span class="o">=</span><span class="k">$(</span>aws efs create-file-system <span class="se">\</span>
    --availability-zone-name <span class="s2">&quot;us-east-1a&quot;</span> <span class="se">\</span>
    --encrypted <span class="se">\</span>
    --tags <span class="s2">&quot;Key=Name,Value=myEFS&quot;</span> <span class="se">\</span>
    --query <span class="s2">&quot;FileSystemId&quot;</span> --output text<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">echo</span> <span class="s2">&quot;Created EFS file system: </span><span class="nv">$EFS_ID</span><span class="s2">&quot;</span>
</code></pre></div>

<p>B) By default, AWS CLI doesn't create a <strong>Mount target</strong>, assign <strong>Security group</strong>, configure <strong>Subnet</strong>, or configure <strong>Lifecycle management</strong>. while we don't need to configure the latter, we do need to create a <strong>Mount target</strong>.</p>
<p>Creating <strong>Mount target</strong> also requires assigning a <strong>Security group</strong> and choosing the <strong>Subnet</strong> where the <strong>Mount target</strong> will be created. We know the <strong>Security group</strong> and its ID already, but we need to find the ID of the default <strong>Subnet</strong> for the <code>us-east-1a</code> availability zone.</p>
<div class="highlight"><pre><span></span><code><span class="nv">SUBNET_ID</span><span class="o">=</span><span class="k">$(</span>aws ec2 describe-subnets <span class="se">\</span>
    --filters <span class="s2">&quot;Name=availability-zone,Values=us-east-1a&quot;</span> <span class="se">\</span>
    --query <span class="s2">&quot;Subnets[0].SubnetId&quot;</span> --output text<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">echo</span> <span class="s2">&quot;Subnet ID for us-east-1a: </span><span class="nv">$SUBNET_ID</span><span class="s2">&quot;</span>
</code></pre></div>

<p>C) Now create the <strong>Mount target</strong>.</p>
<div class="highlight"><pre><span></span><code>aws efs create-mount-target --file-system-id <span class="nv">$EFS_ID</span> <span class="se">\</span>
    --subnet-id <span class="nv">$SUBNET_ID</span> --security-groups <span class="nv">$NFS_SG_ID</span>
</code></pre></div>

<p>This will output the following data, note down the <code>IpAddress</code>.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;OwnerId&quot;</span><span class="p">:</span> <span class="s2">&quot;268674271179&quot;</span><span class="p">,</span>
    <span class="nt">&quot;MountTargetId&quot;</span><span class="p">:</span> <span class="s2">&quot;fsmt-0955bbcc67dccca55&quot;</span><span class="p">,</span>
    <span class="nt">&quot;FileSystemId&quot;</span><span class="p">:</span> <span class="s2">&quot;fs-051523e63a4561e3d&quot;</span><span class="p">,</span>
    <span class="nt">&quot;SubnetId&quot;</span><span class="p">:</span> <span class="s2">&quot;subnet-0b0a5941&quot;</span><span class="p">,</span>
    <span class="nt">&quot;LifeCycleState&quot;</span><span class="p">:</span> <span class="s2">&quot;creating&quot;</span><span class="p">,</span>
    <span class="nt">&quot;IpAddress&quot;</span><span class="p">:</span> <span class="s2">&quot;172.31.23.189&quot;</span><span class="p">,</span>
    <span class="nt">&quot;NetworkInterfaceId&quot;</span><span class="p">:</span> <span class="s2">&quot;eni-057847b7e1c9adf1f&quot;</span><span class="p">,</span>
    <span class="nt">&quot;AvailabilityZoneId&quot;</span><span class="p">:</span> <span class="s2">&quot;use1-az4&quot;</span><span class="p">,</span>
    <span class="nt">&quot;AvailabilityZoneName&quot;</span><span class="p">:</span> <span class="s2">&quot;us-east-1a&quot;</span><span class="p">,</span>
    <span class="nt">&quot;VpcId&quot;</span><span class="p">:</span> <span class="s2">&quot;vpc-7918c403&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="step-3-create-the-ec2-ubuntu-instance">Step 3: Create the EC2 Ubuntu instance</h4>
<p>First open the AWS console, go to <strong>EC2 -&gt; Instances -&gt; Launch instances</strong>. In the <strong>Application and OS Images</strong> section, select <code>Ubuntu</code> and then from the dropdown select <code>Ubuntu 20.04 LTS (HVM)</code>. Note the AMI ID at the bottom. </p>
<p><img alt="25000000-ami-id" src="http://localhost:8080/images/aws-academy/25000000-ami-id.png"></p>
<p>A) Create a new EC2 instance named <code>myServer1</code> in <code>us-east-1a</code>. and store the IP address of the instance in a variable.</p>
<div class="highlight"><pre><span></span><code><span class="nv">MYSERVER1_ID</span><span class="o">=</span><span class="k">$(</span>aws ec2 run-instances <span class="se">\</span>
    --image-id ami-08d4ac5b634553e16 <span class="se">\</span>
    --count <span class="m">1</span> <span class="se">\</span>
    --instance-type t2.micro <span class="se">\</span>
    --key-name myKeyPair <span class="se">\</span>
    --security-group-ids <span class="nv">$DMZ_SG_ID</span> <span class="se">\</span>
    --subnet-id <span class="nv">$SUBNET_ID</span> <span class="se">\</span>
    --associate-public-ip-address <span class="se">\</span>
    --tag-specifications <span class="s2">&quot;ResourceType=instance,Tags=[{Key=Name,Value=myServer1}]&quot;</span> <span class="se">\</span>
    --query <span class="s2">&quot;Instances[0].InstanceId&quot;</span> --output text<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">echo</span> <span class="s2">&quot;Created EC2 instance myServer1: </span><span class="nv">$MYSERVER1_ID</span><span class="s2">&quot;</span>
</code></pre></div>

<p>B) Get the IP address from instance metadata.</p>
<div class="highlight"><pre><span></span><code><span class="nv">MYSERVER1_IP</span><span class="o">=</span><span class="k">$(</span>aws ec2 describe-instances <span class="se">\</span>
    --instance-ids <span class="nv">$MYSERVER1_ID</span> <span class="se">\</span>
    --query <span class="s2">&quot;Reservations[0].Instances[0].PublicIpAddress&quot;</span> --output text<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">echo</span> <span class="s2">&quot;EC2 instance myServer1 IP: </span><span class="nv">$MYSERVER1_IP</span><span class="s2">&quot;</span>
</code></pre></div>

<p>C) Check if the instance state is running and status checks are complete.</p>
<div class="highlight"><pre><span></span><code>aws ec2 <span class="nb">wait</span> instance-status-ok --instance-ids <span class="nv">$MYSERVER1_ID</span>
</code></pre></div>

<h4 id="step-4-login-to-the-ec2-instance">Step 4: Login to the EC2 instance</h4>
<p>Make sure you have a keypair downloaded and parth is specified correctly below</p>
<div class="highlight"><pre><span></span><code>ssh -i ~/.ssh/myKeyPair.pem ubuntu@<span class="nv">$MYSERVER1_IP</span>
</code></pre></div>

<blockquote>
<p>In case you get <code>SSH Permission are too open</code> error, change the file's permission to <code>600</code> by running <code>chmod 600 ~/.ssh/myKeyPair.pem</code></p>
</blockquote>
<p>Install the NFS Utilities</p>
<div class="highlight"><pre><span></span><code>sudo apt install nfs-common -y <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo systemctl status nfs-utils
</code></pre></div>

<h4 id="step-5-mount-the-efs-file-system">Step 5: Mount the EFS File System</h4>
<p>Next, mount the EFS drive to the EC2 instance. Replace <EFS IP> with the IP address of the Mount target from step 2C above</p>
<div class="highlight"><pre><span></span><code>mkdir efs
sudo mount -t nfs4 -o <span class="nv">nfsvers</span><span class="o">=</span><span class="m">4</span>.1,rsize<span class="o">=</span><span class="m">1048576</span>,wsize<span class="o">=</span><span class="m">1048576</span>,hard,timeo<span class="o">=</span><span class="m">600</span>,retrans<span class="o">=</span><span class="m">2</span>,noresvport &lt;EFS IP&gt;:/ efs
</code></pre></div>

<p>Run the following command in the EC2 terminal to see the EFS drive mounted.</p>
<div class="highlight"><pre><span></span><code>lsblk
</code></pre></div>

<p><img alt="25000000-check-efs-mount-lsblk" src="http://localhost:8080/images/aws-academy/25000000-check-efs-mount-lsblk.png"></p>
<h4 id="step-6-test-the-mounted-efs-drive">Step 6: Test the mounted EFS Drive</h4>
<p>A) Download a file and save them in EFS drive.</p>
<div class="highlight"><pre><span></span><code>sudo curl -X GET https://cataas.com/cat -o efs/myFile.jpg
</code></pre></div>

<p>B) List the files</p>
<div class="highlight"><pre><span></span><code>ls -al efs
</code></pre></div>

<p><img alt="25000000-output-server1" src="http://localhost:8080/images/aws-academy/25000000-output-server1.png"></p>
<p>B) Logout from <code>myServer1</code></p>
<div class="highlight"><pre><span></span><code><span class="nb">exit</span>
</code></pre></div>

<p>C) Now back in your AWS CLI, create a new instance named <code>myServer2</code> in <code>us-east-1a</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nv">MYSERVER2_ID</span><span class="o">=</span><span class="k">$(</span>aws ec2 run-instances <span class="se">\</span>
    --image-id ami-08d4ac5b634553e16 <span class="se">\</span>
    --count <span class="m">1</span> <span class="se">\</span>
    --instance-type t2.micro <span class="se">\</span>
    --key-name myKeyPair <span class="se">\</span>
    --security-group-ids <span class="nv">$DMZ_SG_ID</span> <span class="se">\</span>
    --subnet-id <span class="nv">$SUBNET_ID</span> <span class="se">\</span>
    --associate-public-ip-address <span class="se">\</span>
    --tag-specifications <span class="s2">&quot;ResourceType=instance,Tags=[{Key=Name,Value=myServer2}]&quot;</span> <span class="se">\</span>
    --query <span class="s2">&quot;Instances[0].InstanceId&quot;</span> --output text<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">echo</span> <span class="s2">&quot;Created EC2 instance myServer2: </span><span class="nv">$MYSERVER2_ID</span><span class="s2">&quot;</span>
</code></pre></div>

<p>Get the IP address from instance metadata.</p>
<div class="highlight"><pre><span></span><code><span class="nv">MYSERVER2_IP</span><span class="o">=</span><span class="k">$(</span>aws ec2 describe-instances <span class="se">\</span>
    --instance-ids <span class="nv">$MYSERVER2_ID</span> <span class="se">\</span>
    --query <span class="s2">&quot;Reservations[0].Instances[0].PublicIpAddress&quot;</span> --output text<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">echo</span> <span class="s2">&quot;EC2 instance myServer2 IP: </span><span class="nv">$MYSERVER2_IP</span><span class="s2">&quot;</span>
</code></pre></div>

<p>D) Check if the instance state is running and status checks are complete.</p>
<div class="highlight"><pre><span></span><code>aws ec2 <span class="nb">wait</span> instance-status-ok --instance-ids <span class="nv">$MYSERVER2_ID</span>
</code></pre></div>

<p>E) After the above command wait is complete, login to the EC2 instance <code>myServer2</code></p>
<div class="highlight"><pre><span></span><code>ssh -i ~/.ssh/myKeyPair.pem ubuntu@<span class="nv">$MYSERVER2_IP</span>
</code></pre></div>

<p>F) Follow the <a href="#step-5-mount-the-efs-file-system">mount instructions in Step 5</a> above to mount the EFS drive.</p>
<p>Finally, run <code>ls -al efs</code> to see the files in the EFS drive that was downloaded from <code>myServer1</code>.</p>
<p><img alt="25000000-efs-check-server2" src="http://localhost:8080/images/aws-academy/25000000-efs-check-server2.png"></p>
<p>Logout from EC2 instance <code>myServer2</code> before proceeding to next step by running <code>exit</code></p>
<h4 id="step-7-clean-up">Step 7: Clean up</h4>
<p>Clean up the EC2 instances and wait for them to terminate.</p>
<div class="highlight"><pre><span></span><code>aws ec2 terminate-instances --instance-ids <span class="nv">$MYSERVER1_ID</span> <span class="nv">$MYSERVER2_ID</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
  aws ec2 <span class="nb">wait</span> instance-terminated --instance-ids <span class="nv">$MYSERVER1_ID</span> <span class="nv">$MYSERVER2_ID</span>
</code></pre></div>

<p>Next, we need to delete the <strong>Mount target</strong>. First, fetch ID of the Mount target. You can also manually get this from the output in step 2C.</p>
<div class="highlight"><pre><span></span><code><span class="nv">MOUNT_TARGET_ID</span><span class="o">=</span><span class="k">$(</span>aws efs describe-mount-targets <span class="se">\</span>
    --file-system-id <span class="nv">$EFS_ID</span> <span class="se">\</span>
    --query <span class="s2">&quot;MountTargets[0].MountTargetId&quot;</span> --output text<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">echo</span> <span class="s2">&quot;EFS Mount Target ID: </span><span class="nv">$MOUNT_TARGET_ID</span><span class="s2">&quot;</span>
</code></pre></div>

<p>Then, delete the Mount target.</p>
<div class="highlight"><pre><span></span><code>aws efs delete-mount-target --mount-target-id <span class="nv">$MOUNT_TARGET_ID</span>
</code></pre></div>

<p>Finally, delete the EFS file system.</p>
<div class="highlight"><pre><span></span><code>aws efs delete-file-system --file-system-id <span class="nv">$EFS_ID</span>
</code></pre></div>
            </article>
            <h5>Need Help? <a href="https://github.com/CloudBytesDotDev/CloudBytes.dev/discussions">Open a discussion
                    thread on GitHub</a>.</h5>
<div class="article-tags">
    <a href="/tags/aws"><span class="tag tag-aws">#aws</span></a>
    <a href="/tags/linux"><span class="tag tag-linux">#linux</span></a>
</div>            <hr>
<div>
    <h3 style="margin: 10px 0;">Related Posts</h3>
</div>
<div class="chapters-list">
    <div class="chapters-wrap">
        <a href="/aws-academy/how-to-install-and-configure-aws-cli-on-linux-with-autocompletion">
            <div class="box box-sm chapter-item">
                <i class="box-icon">
                    <div>
                        <i class="emoji">📄</i>
                    </div>
                </i>
                <div class="box-content">
                    <span class="subtext">How to install and configure AWS CLI on Linux with Autocompletion</span>
                </div>
            </div>
        </a>
        <a href="/aws-academy/a-brief-introduction-to-aws-autoscaling">
            <div class="box box-sm chapter-item">
                <i class="box-icon">
                    <div>
                        <i class="emoji">📄</i>
                    </div>
                </i>
                <div class="box-content">
                    <span class="subtext">A brief introduction to AWS autoscaling</span>
                </div>
            </div>
        </a>
        <a href="/snippets/mount-aws-credentials-on-vscode-devcontainers">
            <div class="box box-sm chapter-item">
                <i class="box-icon">
                    <div>
                        <i class="emoji">📄</i>
                    </div>
                </i>
                <div class="box-content">
                    <span class="subtext">Mount AWS Credentials on VSCode Devcontainers</span>
                </div>
            </div>
        </a>
        <a href="/aws-academy/setup-your-dev-environment-for-use-with-aws">
            <div class="box box-sm chapter-item">
                <i class="box-icon">
                    <div>
                        <i class="emoji">📄</i>
                    </div>
                </i>
                <div class="box-content">
                    <span class="subtext">Setup your dev environment for use with AWS</span>
                </div>
            </div>
        </a>
        <a href="/snippets/run-chrome-extensions-with-python-selenium-on-aws-lambda">
            <div class="box box-sm chapter-item">
                <i class="box-icon">
                    <div>
                        <i class="emoji">📄</i>
                    </div>
                </i>
                <div class="box-content">
                    <span class="subtext">Run Chrome extensions with Python Selenium on AWS Lambda</span>
                </div>
            </div>
        </a>
    </div>
</div>
        </section>
    </div>

</article>
        <aside class="sidebar">
<div class="recourse" style="text-align:center">
    <div class="box chapter-item">
        <div class="box-content">
            <a href="https://click.linksynergy.com/link?id=zOWbNCBDzko&offerid=1060092.2196488&type=2&murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Faws-certified-solutions-architect-associate-saa-c02%2F" rel="nofollow" style="text-decoration:none">
                <div>
                    <h3 style="border-bottom: 2px white;">📽️ Curated Tutorial</h3>
                    <hr style="border-color:var(--text-color)">
                    <hr style="border-color:var(--text-color)">
                </div>
                <div class=" banner">
                    <IMG border=0 src="https://img-c.udemycdn.com/course/480x270/2196488_8fc7_7.jpg">
                    <h4>
                        Ultimate AWS Certified Solutions Architect Associate 2022
                    </h4>
                    <p style="font-size:.75em">
                        Full Practice Exam Learn Cloud Computing Pass the AWS Certified Solutions Architect Associate Certification SAA-C02!!
                    </p>
                    <h4>
                        <u>Click Here for more info!</u>
                    </h4>
                </div>
            </a>
            <IMG border=0 width=1 height=1 src="https://ad.linksynergy.com/fs-bin/show?id=zOWbNCBDzko&bids=1060092.2196488&type=2&subid=0">
        </div>
    </div>
</div>
        </aside>
    </main>
    <!-- End of Main Section -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <!-- Footer -->

    <footer>
<div class="footer-row">
    <h3>Want to improve this guide? Submit your changes on <a
            href="https://github.com/CloudBytesDotDev/CloudBytes.dev/tree/main/content/aws/25000000-mount-efs-ec2.md">GitHub.</a>
    </h3>
    <p class="copyright">Copyright &copy; 2020 - 2022 CloudBytes. All rights reserved.</p>
    <ul>
        <li class="footer-nav"><a href="/terms">Terms</a></li>
        <li class="footer-nav"><a href="/privacy">Privacy Policy</a></li>
        <li class="footer-nav"><a href="/sitemap.xml">Sitemap</a></li>
    </ul>
</div>    </footer>
</body>
<!-- Include AlgoliaSearch JS Client and autocomplete.js library -->
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
<!-- Initialize autocomplete menu -->
<script>
    var client = algoliasearch("XE8PCLJHAE", "ec75de1d8ce87dee234a2fd47cec2d76");
    var index = client.initIndex('cloudbytes_dev');
    //initialize autocomplete on search input (ID selector must match)
    autocomplete('#algolia-input',
        { hint: false }, {
        source: autocomplete.sources.hits(index, { hitsPerPage: 10 }),
        //value to be displayed in input control after user's suggestion selection
        displayKey: 'title',
        //hash of templates used when rendering dataset
        templates: {
            //'suggestion' templating function used to render a single suggestion
            suggestion: function (suggestion) {
                return '<a class="algolia-hit" href="/' + suggestion.url + '">' +
                    '<h4>' +
                    '<span class="hit-title">' + suggestion._highlightResult.title.value + '</span>' +
                    '</h4>' +
                    '</a>'
            }
        }
    });
</script>

</html>